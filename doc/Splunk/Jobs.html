<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />

	<title>Class: Splunk::Jobs</title>

	<link rel="stylesheet" href="../rdoc.css" type="text/css" media="screen" />

	<script src="../js/jquery.js" type="text/javascript"
		charset="utf-8"></script>
	<script src="../js/thickbox-compressed.js" type="text/javascript"
		charset="utf-8"></script>
	<script src="../js/quicksearch.js" type="text/javascript"
		charset="utf-8"></script>
	<script src="../js/darkfish.js" type="text/javascript"
		charset="utf-8"></script>

</head>
<body class="class">

	<div id="metadata">
		<div id="home-metadata">
			<div id="home-section" class="section">
        <h3 class="section-header">
          <a href="../index.html">Home</a>
          <a href="../index.html#classes">Classes</a>
          <a href="../index.html#methods">Methods</a>
        </h3>
			</div>
		</div>

		<div id="file-metadata">
			<div id="file-list-section" class="section">
				<h3 class="section-header">In Files</h3>
				<div class="section-body">
					<ul>
					
						<li><a href="../lib/splunk-sdk-ruby/client_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
							class="thickbox" title="lib/splunk-sdk-ruby/client.rb">lib/splunk-sdk-ruby/client.rb</a></li>
					
					</ul>
				</div>
			</div>

			
		</div>

		<div id="class-metadata">

			<!-- Parent Class -->
			
			<div id="parent-class-section" class="section">
				<h3 class="section-header">Parent</h3>
				
				<p class="link"><a href="Collection.html">Splunk::Collection</a></p>
				
			</div>
			

			<!-- Namespace Contents -->
			

			<!-- Method Quickref -->
			
			<div id="method-list-section" class="section">
				<h3 class="section-header">Methods</h3>
				<ul class="link-list">
					
					<li><a href="#method-c-new">::new</a></li>
					
					<li><a href="#method-i-create">#create</a></li>
					
					<li><a href="#method-i-create_oneshot">#create_oneshot</a></li>
					
					<li><a href="#method-i-create_stream">#create_stream</a></li>
					
					<li><a href="#method-i-list">#list</a></li>
					
				</ul>
			</div>
			

			<!-- Included Modules -->
			
		</div>

		<div id="project-metadata">
			
			
			<div id="fileindex-section" class="section project-section">
				<h3 class="section-header">Files</h3>
				<ul>
				
					<li class="file"><a href="../Gemfile.html">Gemfile</a></li>
				
					<li class="file"><a href="../LICENSE.html">LICENSE</a></li>
				
					<li class="file"><a href="../README_rdoc.html">README.rdoc</a></li>
				
					<li class="file"><a href="../Rakefile.html">Rakefile</a></li>
				
					<li class="file"><a href="../TODO.html">TODO</a></li>
				
					<li class="file"><a href="../test/testfile_txt.html">testfile.txt</a></li>
				
				</ul>
			</div>
			

			<div id="classindex-section" class="section project-section">
				<h3 class="section-header">Class Index
					<span class="search-toggle"><img src="../images/find.png"
						height="16" width="16" alt="[+]"
						title="show/hide quicksearch" /></span></h3>
				<form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
				<fieldset>
					<legend>Quicksearch</legend>
					<input type="text" name="quicksearch" value=""
						class="quicksearch-field" />
				</fieldset>
				</form>

				<ul class="link-list">
				
					<li><a href="../Splunk.html">Splunk</a></li>
				
					<li><a href="../Splunk/AtomResponseLoader.html">Splunk::AtomResponseLoader</a></li>
				
					<li><a href="../Splunk/Collection.html">Splunk::Collection</a></li>
				
					<li><a href="../Splunk/Conf.html">Splunk::Conf</a></li>
				
					<li><a href="../Splunk/ConfCollection.html">Splunk::ConfCollection</a></li>
				
					<li><a href="../Splunk/Context.html">Splunk::Context</a></li>
				
					<li><a href="../Splunk/Entity.html">Splunk::Entity</a></li>
				
					<li><a href="../Splunk/Index.html">Splunk::Index</a></li>
				
					<li><a href="../Splunk/Job.html">Splunk::Job</a></li>
				
					<li><a href="../Splunk/Jobs.html">Splunk::Jobs</a></li>
				
					<li><a href="../Splunk/Message.html">Splunk::Message</a></li>
				
					<li><a href="../Splunk/ResultsReader.html">Splunk::ResultsReader</a></li>
				
					<li><a href="../Splunk/SearchResults.html">Splunk::SearchResults</a></li>
				
					<li><a href="../Splunk/Service.html">Splunk::Service</a></li>
				
					<li><a href="../Splunk/SplunkError.html">Splunk::SplunkError</a></li>
				
					<li><a href="../Splunk/SplunkHTTPError.html">Splunk::SplunkHTTPError</a></li>
				
					<li><a href="../JSON.html">JSON</a></li>
				
					<li><a href="../JSON/Stream.html">JSON::Stream</a></li>
				
					<li><a href="../JSON/Stream/Parser.html">JSON::Stream::Parser</a></li>
				
					<li><a href="../Hash.html">Hash</a></li>
				
				</ul>
				<div id="no-class-search-results" style="display: none;">No matching classes.</div>
			</div>

			
		</div>
	</div>

	<div id="documentation">
		<h1 class="class">Splunk::Jobs</h1>

		<div id="description">
			<p>
<a href="Jobs.html">Jobs</a> objects are used for executing searches and
retrieving a list of all jobs
</p>

		</div>

		<!-- Constants -->
		

		<!-- Attributes -->
		

		<!-- Methods -->
		
		<div id="public-class-method-details" class="method-section section">
			<h3 class="section-header">Public Class Methods</h3>

		
			<div id="new-method" class="method-detail ">
				<a name="method-c-new"></a>

				<div class="method-heading">
				
					<span class="method-name">new</span><span
						class="method-args">(svc)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="new-source">
<pre>
     <span class="ruby-comment cmt"># File lib/splunk-sdk-ruby/client.rb, line 787</span>
787:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">svc</span>)
788:       <span class="ruby-ivar">@service</span> = <span class="ruby-identifier">svc</span>
789:       <span class="ruby-identifier">item</span> = <span class="ruby-constant">Proc</span>.<span class="ruby-identifier">new</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">service</span>, <span class="ruby-identifier">sid</span><span class="ruby-operator">|</span> <span class="ruby-constant">Job</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">service</span>, <span class="ruby-identifier">sid</span>)}
790:       <span class="ruby-keyword kw">super</span>(<span class="ruby-identifier">svc</span>, <span class="ruby-constant">PATH_JOBS</span>, <span class="ruby-value str">&quot;jobs&quot;</span>, <span class="ruby-value">:item</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">item</span>)
791:     <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
		</div>
	
		<div id="public-instance-method-details" class="method-section section">
			<h3 class="section-header">Public Instance Methods</h3>

		
			<div id="create-method" class="method-detail ">
				<a name="method-i-create"></a>

				<div class="method-heading">
				
					<span class="method-name">create</span><span
						class="method-args">(query, args={})</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Run a search.  This search can be either synchronous (oneshot) or
asynchronous.  A synchronous search will execute the search and the caller
will block until the results have been returned.  An asynchronous search
will return immediately, returning a <a href="Job.html">Job</a> object that
can be queried for completion, paused, etc. There are many possible
arguments - all are documented in the <a href="../Splunk.html">Splunk</a>
REST documentation at <a
href="http://docs.splunk.com/Documentation/Splunk/latest/RESTAPI/RESTsearch#search.2Fjobs">docs.splunk.com/Documentation/Splunk/latest/RESTAPI/RESTsearch#search.2Fjobs</a>
- POST.  The one that controls either synchronous or asynchronous is called
<b><tt>:exec_mode</tt></b>.
</p>
<h4>Example 1 - Execute a synchronous search returning XML (XML is the default output mode )</h4>
<pre>
  svc = Splunk::Service.connect(:username =&gt; 'admin', :password =&gt; 'foo')
  puts svc.jobs.create(&quot;search error&quot;, :max_count =&gt; 10, :max_results =&gt; 10, :exec_mode =&gt; 'oneshot')
</pre>
<h4>Example 2 - Execute a synchronous search returning results in <a href="../JSON.html">JSON</a></h4>
<pre>
  svc = Splunk::Service.connect(:username =&gt; 'admin', :password =&gt; 'foo')
  puts svc.jobs.create(&quot;search error&quot;, :max_count =&gt; 10, :max_results =&gt; 10, :exec_mode =&gt; 'oneshot', :output_mode =&gt; 'json')
</pre>
<h4>Example 3 - Execute a synchronous search returning a <a href="Job.html">Job</a> object with the results as a <a href="../JSON.html">JSON</a> String</h4>
<pre>
  svc = Splunk::Service.connect(:username =&gt; 'admin', :password =&gt; 'foo')
  job = svc.jobs.create(&quot;search error&quot;, :max_count =&gt; 10, :max_results =&gt; 10, :exec_mode =&gt; 'blocking')
  puts job.results(:output_mode =&gt; 'json')
</pre>
<h4>Example 4 - Execute an asynchronous search and wait for all the results (returned in <a href="../JSON.html">JSON</a>)</h4>
<pre>
  svc = Splunk::Service.connect(:username =&gt; 'admin', :password =&gt; 'foo')
  job = svc.jobs.create(&quot;search error&quot;, :max_count =&gt; 10, :max_results =&gt; 10)
  while true
    stats = job.read(['isDone'])
    break if stats['isDone'] == '1'
    sleep(1)
  end
  puts job.results(:output_mode =&gt; 'json')</pre>
					

					
					<div class="method-source-code"
						id="create-source">
<pre>
     <span class="ruby-comment cmt"># File lib/splunk-sdk-ruby/client.rb, line 822</span>
822:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create</span>(<span class="ruby-identifier">query</span>, <span class="ruby-identifier">args</span>={})
823:       <span class="ruby-identifier">args</span>[<span class="ruby-value str">&quot;search&quot;</span>] = <span class="ruby-identifier">query</span>
824:       <span class="ruby-identifier">response</span> = <span class="ruby-ivar">@service</span>.<span class="ruby-identifier">context</span>.<span class="ruby-identifier">post</span>(<span class="ruby-constant">PATH_JOBS</span>, <span class="ruby-identifier">args</span>)
825: 
826:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">response</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">args</span>[<span class="ruby-value">:exec_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">'oneshot'</span>
827: 
828:       <span class="ruby-identifier">response</span> = <span class="ruby-constant">AtomResponseLoader</span><span class="ruby-operator">::</span><span class="ruby-identifier">load_text</span>(<span class="ruby-identifier">response</span>)
829:       <span class="ruby-identifier">sid</span> = <span class="ruby-identifier">response</span>[<span class="ruby-value str">'response'</span>][<span class="ruby-value str">'sid'</span>]
830:       <span class="ruby-constant">Job</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@service</span>, <span class="ruby-identifier">sid</span>)
831:     <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="create-oneshot-method" class="method-detail ">
				<a name="method-i-create_oneshot"></a>

				<div class="method-heading">
				
					<span class="method-name">create_oneshot</span><span
						class="method-args">(query, args={})</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Convenience method that runs a synchronous search returning an enumerable
<a href="SearchResults.html">SearchResults</a> object. This object allows
you to iterate through each individual event. You can use any arguments
from the REST call (specfied in <a
href="Jobs.html#method-i-create">Jobs.create</a>) you wish, but
&#8217;:exec_mode&#8217; and &#8217;:output_mode&#8217; will always be set
to &#8216;oneshot&#8217; and &#8216;json&#8217; respectively.
</p>
<h4>Example - Execute a search and show just the raw events followed by the event count</h4>
<pre>
   svc = Splunk::Service.connect(:username =&gt; 'admin', :password =&gt; 'foo')
   results = svc.jobs.create_oneshot(&quot;search error&quot;, :max_count =&gt; 10, :max_results =&gt; 10)
   results.each {|event| puts event['_raw']}
   puts results.count</pre>
					

					
					<div class="method-source-code"
						id="create-oneshot-source">
<pre>
     <span class="ruby-comment cmt"># File lib/splunk-sdk-ruby/client.rb, line 843</span>
843:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_oneshot</span>(<span class="ruby-identifier">query</span>, <span class="ruby-identifier">args</span>={})
844:       <span class="ruby-identifier">args</span>[<span class="ruby-value">:search</span>] = <span class="ruby-identifier">query</span>
845:       <span class="ruby-identifier">args</span>[<span class="ruby-value">:exec_mode</span>] = <span class="ruby-value str">&quot;oneshot&quot;</span>
846:       <span class="ruby-identifier">args</span>[<span class="ruby-value">:output_mode</span>] = <span class="ruby-value str">&quot;json&quot;</span>
847:       <span class="ruby-identifier">response</span> = <span class="ruby-ivar">@service</span>.<span class="ruby-identifier">context</span>.<span class="ruby-identifier">post</span>(<span class="ruby-constant">PATH_JOBS</span>, <span class="ruby-identifier">args</span>)
848: 
849:       <span class="ruby-identifier">json</span> = <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">response</span>)
850:       <span class="ruby-constant">SearchResults</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">json</span>)
851:     <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="create-stream-method" class="method-detail ">
				<a name="method-i-create_stream"></a>

				<div class="method-heading">
				
					<span class="method-name">create_stream</span><span
						class="method-args">(query, args={})</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Run a <b>streamed search</b> .  Rather than returning an object that can
take up a huge amount of memory by including large numbers of search
results, a streamed search buffers only a chunk at a time and provides an
interface that the client can use to retrieve results without taking up any
more memory than just for the buffer itself. The arguments are exactly the
same as for the other search methods in this class except that
<b><tt>:output_mode</tt></b> will always be &#8216;json&#8217; because
results are always in <a href="../JSON.html">JSON</a>.
</p>
<p>
Returns a <a href="ResultsReader.html">Splunk::ResultsReader</a> object
</p>
<h4>Example 1 - Simple streamed search</h4>
<pre>
  svc = Splunk::Service.connect(:username =&gt; 'admin', :password =&gt; 'foo')
  reader = svc.jobs.create_stream('search host=&quot;45.2.94.5&quot; | timechart count')
  reader.each {|event| puts event}
</pre>
<h4>Example 2 - Real time streamed search</h4>
<pre>
  svc = Splunk::Service.connect(:username =&gt; 'admin', :password =&gt; 'foo')
  reader = svc.jobs.create_stream('search index=_internal',\
  :search_mode =&gt; 'realtime', :earliest_time =&gt; 'rt-1m', :latest_time =&gt; 'rt')
  reader.each {|event| puts event} #will block until events show up in real-time</pre>
					

					
					<div class="method-source-code"
						id="create-stream-source">
<pre>
     <span class="ruby-comment cmt"># File lib/splunk-sdk-ruby/client.rb, line 871</span>
871:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_stream</span>(<span class="ruby-identifier">query</span>, <span class="ruby-identifier">args</span>={})
872:       <span class="ruby-identifier">args</span>[<span class="ruby-value">:search</span>] = <span class="ruby-identifier">query</span>
873:       <span class="ruby-identifier">args</span>[<span class="ruby-value">:output_mode</span>] = <span class="ruby-value str">&quot;json&quot;</span>
874: 
875:       <span class="ruby-identifier">path</span> = <span class="ruby-constant">PATH_EXPORT</span> <span class="ruby-operator">+</span> <span class="ruby-node">&quot;?#{args.urlencode}&quot;</span>
876: 
877:       <span class="ruby-identifier">cn</span> = <span class="ruby-ivar">@service</span>.<span class="ruby-identifier">context</span>.<span class="ruby-identifier">connect</span>
878:       <span class="ruby-identifier">cn</span>.<span class="ruby-identifier">write</span>(<span class="ruby-node">&quot;GET #{@service.context.fullpath(path)} HTTP/1.1\r\n&quot;</span>)
879:       <span class="ruby-identifier">cn</span>.<span class="ruby-identifier">write</span>(<span class="ruby-node">&quot;Host: #{@service.context.host}:#{@service.context.port}\r\n&quot;</span>)
880:       <span class="ruby-identifier">cn</span>.<span class="ruby-identifier">write</span>(<span class="ruby-value str">&quot;User-Agent: splunk-sdk-ruby/0.1\r\n&quot;</span>)
881:       <span class="ruby-identifier">cn</span>.<span class="ruby-identifier">write</span>(<span class="ruby-node">&quot;Authorization: Splunk #{@service.context.token}\r\n&quot;</span>)
882:       <span class="ruby-identifier">cn</span>.<span class="ruby-identifier">write</span>(<span class="ruby-value str">&quot;Accept: */*\r\n&quot;</span>)
883:       <span class="ruby-identifier">cn</span>.<span class="ruby-identifier">write</span>(<span class="ruby-value str">&quot;\r\n&quot;</span>)
884: 
885:       <span class="ruby-identifier">cn</span>.<span class="ruby-identifier">readline</span> <span class="ruby-comment cmt">#return code TODO: Parse me and return error if problem</span>
886:       <span class="ruby-identifier">cn</span>.<span class="ruby-identifier">readline</span> <span class="ruby-comment cmt">#accepts</span>
887:       <span class="ruby-identifier">cn</span>.<span class="ruby-identifier">readline</span> <span class="ruby-comment cmt">#blank</span>
888: 
889:       <span class="ruby-constant">ResultsReader</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">cn</span>)
890:     <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="list-method" class="method-detail ">
				<a name="method-i-list"></a>

				<div class="method-heading">
				
					<span class="method-name">list</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Return an Array of <a href="Jobs.html">Jobs</a>
</p>
<h4>Example - Display the disk usage of each job</h4>
<pre>
  svc = Splunk::Service.connect(:username =&gt; 'admin', :password =&gt; 'foo')
  svc.jobs.list.each {|job| puts job['diskUsage'] }</pre>
					

					
					<div class="method-source-code"
						id="list-source">
<pre>
     <span class="ruby-comment cmt"># File lib/splunk-sdk-ruby/client.rb, line 897</span>
897:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">list</span>
898:       <span class="ruby-identifier">response</span> = <span class="ruby-ivar">@service</span>.<span class="ruby-identifier">context</span>.<span class="ruby-identifier">get</span>(<span class="ruby-constant">PATH_JOBS</span>)
899:       <span class="ruby-identifier">entry</span> = <span class="ruby-constant">AtomResponseLoader</span><span class="ruby-operator">::</span><span class="ruby-identifier">load_text_as_record</span>(<span class="ruby-identifier">response</span>, <span class="ruby-constant">MATCH_ENTRY_CONTENT</span>, <span class="ruby-constant">NAMESPACES</span>)
900:       <span class="ruby-keyword kw">return</span> [] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">nil?</span>
901:       <span class="ruby-identifier">entry</span> = [<span class="ruby-identifier">entry</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">entry</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Array</span>
902:       <span class="ruby-identifier">retarr</span> = []
903:       <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span> <span class="ruby-identifier">retarr</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Job</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@service</span>, <span class="ruby-identifier">item</span>.<span class="ruby-identifier">content</span>.<span class="ruby-identifier">sid</span>) }
904:       <span class="ruby-identifier">retarr</span>
905:     <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
		</div>
	

	</div>


	<div id="rdoc-debugging-section-dump" class="debugging-section">
	
		<p>Disabled; run with --debug to generate this.</p>
	
	</div>

	<div id="validator-badges">
		<p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
		<p><small>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish
			Rdoc Generator</a> 1.1.6</small>.</p>
	</div>

</body>
</html>

